# Gmail

## 1. Тема и целевая аудитория

### Тема
Почтовый сервис

### Целевая аудитория
Количество активных пользователей в месяц 21 млн
1) США - 13%
2) Бразилия - 12.55%
3) Россия - 10.77%
4) Мексика - 4.4%

### MVP функционал
- отправка и получение писем
- просмотр/поиск писем
- добавление файлов к письму
- сортировка писем
- создание папок
- блокировка нежелательных писем/спама

### Продуктовые решения
- размер почтового ящика 5 ГБ
- удаление писем старше 1 года
- ограничение на отправку файлов выше 25 МБ
- предпросмотр файлов перед скачиванием
- возможность подключения сторонних почтовых сервисов, чтобы все письма приходили в одно место

### Источники
- https://reklama.rambler-co.ru/sites/rambler-mail/

## 2. Расчет нагрузки

### Продуктовые метрики
- MAU 21 млн
- DAU 14 млн

### Хранилище пользователя
Данные пользователя (личные данные, пароль, двойная аутентификация и т.д.) - до 5 КБ
Ящик писем - 5 ГБ (максимальное кол-во писем - 400)
адресная книга - 10 КБ

### Среднее количество запросов в день для пользователя
- Отправка письма
- Получение страницы писем
- Просмотр содержимого письма
- Загрузка файла
- Скачивание файла
- Поиск по письмам
- Блокировка писем
- Отметить письмо прочитанным

### Технические метрики (RPS)
|Тип запроса|Средний RPS|Максимальный RPS|
|-|-|-|
|Отправка письма|5672|10210|
|Получение страницы писем|3240|5832|
|Просмотр содержимого письма|7000|12600|
|Загрузка файла|2836|5105|
|Скачивание файла|3500|6300|
|Поиск по письмам|1620|2916|
|Блокировка писем|487|877|
|Отметить письмо прочитанным|7000|12600|

Максимальный RPS = Средний RPS * 1.8

|Тип запроса|Средняя нагрузка, Гбит/с|
|-|-|
|Отправка письма|141|
|Получение страницы писем|21.8|
|Просмотр содержимого письма|18.7|
|Загрузка файла|133|
|Скачивание файла|133|
|Поиск по письмам|10.9|
|Блокировка писем|0.004|
|Отметить письмо прочитанным|0.06|

Итого: средняя нагрузка ~ 325.3 Гбит/с; максимальная нагрузка ~ 586 Гбит/с

## 3. Глобальная балансировка нагрузки

### Функциональное разбиение по доменам (при наличии, нужно для следующего пункта)
- mail.rambler.com
- help.rambler.com

### Расположения ДЦ (влияние на продуктовые метрики)
ДЦ расположены так, чтобы покрывать максимальную территорию в странах с наибольшим количеством активных пользователей
- США: Майами, Атланта, Чикаго
- Россия: Москва, Санкт-Петербург, Новосибирск, Владивосток
- Стамбул
- Бразилия

### DNS балансировка
Для балансировки будет использоваться метод, позволяющий находить сервер с наименьшим временем отклика

### Схема Anycast балансировки
Будет использоваться Anycast. ДЦ в одной стране будут делить один IP адрес. Протокол BGP позволит отправлять данные в ближайший ДЦ 
